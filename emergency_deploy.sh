#!/bin/bash

echo "ðŸš¨ EMERGENCY DEPLOYMENT: Deploying only essential functions to stop runaway costs..."

# Deploy only essential functions (exclude problematic ones)
echo "ðŸ“¦ Deploying essential functions only..."

# Deploy core functions without triggers
firebase deploy --only functions:logAIActionCallable,functions:analyzeAITraining,functions:generateJobDescription,functions:getUsersByTenant,functions:getSalespeople,functions:getCompanyLocations,functions:addCompanyToCRM,functions:findContactEmail,functions:fetchCompanyNews,functions:fetchFollowedCompanyNews,functions:scrapeIndeedJobs,functions:enhanceCompanyWithSerp,functions:enhanceContactWithAI,functions:findDecisionMakers,functions:findDecisionMakersHttp,functions:manageAssociations,functions:fixContactAssociations,functions:linkContactsToCompanies,functions:linkCRMEntities,functions:migrateContactSchema,functions:findTenantIds,functions:extractCompanyInfoFromUrls,functions:triggerAINoteReview,functions:triggerAINoteReviewHttp,functions:updateCompanyPipelineTotals,functions:generateDealAISummary,functions:associationsIntegrityReport,functions:rebuildDealAssociations,functions:rebuildEntityReverseIndex,functions:rebuildCompanyLocationMirror,functions:rebuildCompanyLocationMirrorHttp,functions:companyLocationMirrorStats,functions:deleteDuplicateCompanies,functions:cleanupContactCompanyAssociations,functions:cleanupContactCompanyAssociationsHttp,functions:cleanupUndefinedValues,functions:bulkEmailDomainMatching,functions:removeDuplicateCompanies,functions:removeContactsWithoutNames,functions:removeDuplicateContacts,functions:removePhoneNumberContacts,functions:enrichCompanyWeekly,functions:enrichCompanyBatch,functions:discoverCompanyLocations,functions:discoverCompanyUrls,functions:logContactEnhanced,functions:enrichCompanyOnDemand,functions:getEnrichmentStats,functions:enrichContactOnDemand,functions:setupCalendarWatch,functions:calendarWebhook,functions:stopCalendarWatch,functions:refreshCalendarWatch,functions:getCalendarWebhookStatus,functions:getSalespeopleForTenant,functions:runAIScheduler,functions:manualSchedulerRun,functions:logAIAction,functions:generateFeedbackPrompts,functions:createFeedbackCampaign,functions:submitFeedbackResponse,functions:getFeedbackResults,functions:getFeedbackAISummary,functions:listFeedbackCampaigns,functions:listCustomerToneOverrides,functions:getCustomerTone,functions:setCustomerTone,functions:resetCustomerTone,functions:getGlobalContext,functions:setGlobalContext,functions:listScenarios,functions:getScenario,functions:setScenario,functions:deleteScenario,functions:listContextVersions,functions:restoreContextVersion,functions:listAILogs,functions:setWeightsConfig,functions:processAILog,functions:reprocessLog,functions:runAILogTests,functions:createTestLog,functions:reprocessTestLog,functions:getTestResults,functions:cleanupTestData,functions:getAIAnalytics,functions:getRealTimeAIAnalytics,functions:exportAnalyticsData,functions:getAIChatSettings,functions:updateAIChatSettings,functions:getAIChatConversations,functions:createAIChatConversation,functions:sendAIChatMessage,functions:escalateConversation,functions:analyzeConversationSentiment,functions:getAIChatAnalytics,functions:getRealTimeAIChatAnalytics,functions:getFAQSuggestions,functions:scheduleRecurringCheckinV2,functions:getPendingCheckins,functions:trackSatisfaction,functions:getGmailAuthUrl,functions:getGmailConfig,functions:getGmailStatus,functions:handleGmailCallback,functions:initiateBulkGmailImport,functions:syncGmailAndCreateTasks,functions:syncGmailCalendarAsTasks,functions:syncGmailEmails,functions:sendGmailEmail,functions:sendEmailTaskViaGmail,functions:testGmailEmailCapture,functions:testGmailTokenValidity,functions:monitorGmailForContactEmails,functions:getSSOConfig,functions:updateSSOConfig,functions:testSSOConnection,functions:getSCIMConfig,functions:updateSCIMConfig,functions:syncSCIMUsers,functions:getHRISConfig,functions:updateHRISConfig,functions:syncHRISData,functions:getSlackConfig,functions:updateSlackConfig,functions:testSlackConnection,functions:getIntegrationLogs,functions:manualSync,functions:getIntegrationStatuses,functions:createTask,functions:updateTask,functions:completeTask,functions:quickCompleteTask,functions:deleteTask,functions:getTasks,functions:getTasksForDate,functions:getTaskDashboard,functions:getAITaskSuggestions,functions:acceptAITaskSuggestion,functions:rejectAITaskSuggestion,functions:getDealStageAISuggestions,functions:generateTaskContent,functions:createNextRepeatingTask,functions:associateDealsWithSalespeople,functions:createExplicitAssociations,functions:getVectorCollections,functions:reindexVectorCollection,functions:getContextEngines,functions:getContextSources,functions:runContextAssembly,functions:getRetrievalFilters,functions:createRetrievalFilter,functions:updateRetrievalFilter,functions:deleteRetrievalFilter,functions:getPromptTemplates,functions:createPromptTemplate,functions:updatePromptTemplate,functions:testPromptTemplate,functions:getAutoDevOpsLogs,functions:getAutoDevOpsSettings,functions:updateAutoDevOpsSettings,functions:applyAutoDevOpsPatch,functions:createAutoDevOpsLog,functions:analyzeAILogsForPatterns,functions:getAILogQualityMetrics,functions:suggestConfigImprovements,functions:collectAIFeedback,functions:generateAIPerformanceInsights,functions:getAIFeedbackData,functions:manageCustomerFAQ,functions:getFirmographics,functions:getGlobalContext,functions:gmailOAuthCallback,functions:handleCalendarCallback,functions:handleGmailCallback,functions:inviteUserV2,functions:linkCRMEntities,functions:linkContactsToCompanies,functions:listAILogs,functions:listCalendarEvents,functions:listContextVersions,functions:listCustomerToneOverrides,functions:listFeedbackCampaigns,functions:listScenarios,functions:logAIActionCallable,functions:logAIUserMessage,functions:logMobileAppError,functions:logMotivationEvent,functions:manageAssociations,functions:manageCustomerFAQ,functions:manageTenantCustomers,functions:manualSchedulerRun,functions:manualSync,functions:markBoostViewed,functions:markBroadcastRead,functions:markInviteTokenUsed,functions:metricsIngest,functions:migrateAssociationsToObjects,functions:migrateContactSchema,functions:monitorAIEngineProcessing,functions:monitorAIEngineProcessingWithSelfHealing,functions:monitorBuildDeploymentErrors,functions:monitorGmailForContactEmails,functions:monitorLoggingErrors,functions:monitorMobileAppErrors,functions:normalizeCompanySizes,functions:orchestratePrompt,functions:parseResume,functions:processAILog,functions:quickCompleteTask,functions:rebuildAllCompanyActiveSalespeople,functions:rebuildCompanyActiveSalespeople,functions:rebuildCompanyLocationMirror,functions:rebuildCompanyLocationMirrorHttp,functions:rebuildContactActiveSalespeople,functions:rebuildDealAssociations,functions:rebuildEntityReverseIndex,functions:refreshCalendarWatch,functions:reindexVectorCollection,functions:rejectAITaskSuggestion,functions:removeContactsWithoutNames,functions:removeDuplicateCompanies,functions:removeDuplicateContacts,functions:removePhoneNumberContacts,functions:replyToBroadcast,functions:reprocessTestLog,functions:rescoreVectorChunk,functions:resendInviteV2,functions:resetCustomerTone,functions:restoreContextVersion,functions:revokeInviteV2,functions:runAILogTests,functions:runAIScheduler,functions:runContextAssembly,functions:scheduleAutomatedJSIReports,functions:scheduleContinuousLearning,functions:scheduleRecurringCheckinV2,functions:scheduledGmailSync,functions:scheduledTriggerTests,functions:scrapeIndeedJobs,functions:searchCodeChunks,functions:searchVectorChunks,functions:seedMotivationMessagesFromAPI,functions:sendAIChatMessage,functions:sendBirthdayMessage,functions:sendBroadcast,functions:sendEmailTaskViaGmail,functions:sendGmailEmail,functions:sendHelloMessage,functions:sendWeeklyBalanceCheckIns,functions:sendWeeklyGrowthPrompts,functions:setCustomerTone,functions:setGlobalContext,functions:setScenario,functions:setWeightsConfig,functions:setupCalendarWatch,functions:simulateOrchestrationScenario,functions:skipLearningBoost,functions:startAIThread,functions:stopCalendarWatch,functions:submitBalanceCheckIn,functions:submitFeedbackResponse,functions:submitResetModeCheckIn,functions:submitWellbeingReflection,functions:suggestConfigImprovements,functions:syncApolloHeadquartersLocation,functions:syncCalendarEventsToCRM,functions:syncGmailAndCreateTasks,functions:syncGmailCalendarAsTasks,functions:syncGmailEmails,functions:syncHRISData,functions:syncSCIMUsers,functions:syncTaskToCalendar,functions:tagChunk,functions:testCalendarTokenValidity,functions:testFilterEffectiveness,functions:testGmailEmailCapture,functions:testGmailTokenValidity,functions:testOrchestration,functions:testPromptTemplate,functions:testSSOConnection,functions:testSlackConnection,functions:testUserUpdate,functions:toggleHrxFlex,functions:trackSatisfaction,functions:translateContent,functions:triggerAINoteReview,functions:triggerAINoteReviewHttp,functions:triggerAISummaryUpdate,functions:triggerJSIPrompts,functions:triggerScheduledCheckins,functions:updateAIChatSettings,functions:updateAgencyAISettings,functions:updateAutoDevOpsSettings,functions:updateCalendarEvent,functions:updateCareerGoal,functions:updateChunkRelevance,functions:updateCompanyPipelineTotals,functions:updateCustomerAISettings,functions:updateGmailConfig,functions:updateGoogleSync,functions:updateHRISConfig,functions:updateHelloMessageSettings,functions:updateHelpArticlesWithNewInfo,functions:updateHelpTopic,functions:updateImprovementStatus,functions:updateJSIMessagingConfig,functions:updateLocationAssociation,functions:updateLocationAssociationHttp,functions:updatePromptTemplate,functions:updateRetrievalFilter,functions:updateSCIMConfig,functions:updateSSOConfig,functions:updateSkillsInventory,functions:updateSlackConfig,functions:updateTask,functions:updateTenantAIEngagementSettings,functions:updateUserLoginInfo,functions:updateUserPrimaryTenant,functions:upsertCodeChunks,functions:upsertCodeChunksHttp,functions:validateInviteToken,functions:validatePromptConsistency,functions:validateTenantSlug

echo "âœ… Emergency deployment completed!"
echo "ðŸš¨ IMPORTANT: Problematic Firestore triggers have been disabled"
echo "ðŸ“‹ Check the Firebase Console to verify functions are deployed correctly"
echo "ðŸ’° Monitor your costs - they should start decreasing immediately"
